!function(e){var t=0,a=function(){return(new Date).getTime()+t++},n=function(e){return"["+e+"]$1"},i=function(e){return"_"+e+"_$1"};e(document).on("click",".add_fields",function(t){t.preventDefault();var o=e(this),r=o.data("association"),s=o.data("associations"),c=o.data("association-insertion-template"),d=o.data("association-insertion-method")||o.data("association-insertion-position")||"before",p=o.data("association-insertion-node"),f=o.data("association-insertion-traversal"),l=parseInt(o.data("count"),10),u=new RegExp("\\[new_"+r+"\\](.*?\\s)","g"),g=new RegExp("_new_"+r+"_(\\w*)","g"),v=a(),m=c.replace(u,n(v)),_=[];for(m==c&&(u=new RegExp("\\[new_"+s+"\\](.*?\\s)","g"),g=new RegExp("_new_"+s+"_(\\w*)","g"),m=c.replace(u,n(v))),m=m.replace(g,i(v)),_=[m],l=isNaN(l)?1:Math.max(l,1),l-=1;l;)v=a(),m=c.replace(u,n(v)),m=m.replace(g,i(v)),_.push(m),l-=1;p=p?f?o[f](p):"this"==p?o:e(p):o.parent(),e.each(_,function(t,a){var n=e(a);p.trigger("cocoon:before-insert",[n]);p[d](n);p.trigger("cocoon:after-insert",[n])})}),e(document).on("click",".remove_fields.dynamic, .remove_fields.existing",function(t){var a=e(this),n=a.data("wrapper-class")||"nested-fields",i=a.closest("."+n),o=i.parent();t.preventDefault(),o.trigger("cocoon:before-remove",[i]);var r=o.data("remove-timeout")||0;setTimeout(function(){a.hasClass("dynamic")?i.remove():(a.prev("input[type=hidden]").val("1"),i.hide()),o.trigger("cocoon:after-remove",[i])},r)}),e(".remove_fields.existing.destroyed").each(function(){var t=e(this),a=t.data("wrapper-class")||"nested-fields";t.closest("."+a).hide()})}(jQuery);